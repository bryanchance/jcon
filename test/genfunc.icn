#SRC: JCON

# test dynamic loading of a generated function

procedure main()
   local f, p, i

   remove("tmp.icn")
   remove("tmp.zip")
   f := open("tmp.icn", "w") | stop("can't open tmp.icn")
   wproc(f)
   close(f)
   system("../bin/jcont -s -c tmp")
   p := loadfunc("tmp.zip", "inv")
   every i := 1 to 25 do 
      write("1/", i, " = ", p(i))
   remove("tmp.zip")
   remove("tmp.icn")
end

procedure wproc(f)
   every write(f, ![
      "procedure inv(x)", 
      "   return adiv(-1.0, x)",
      "end",
      "",
      "procedure adiv(a, b)",
      "   return abs(a) / b",
      "end"
   ]);
end
